<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dịch Song Song Anh-Việt | Song Ngữ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(90deg, #1e3c72, #2a5298);
            color: white;
            padding: 25px 40px;
            text-align: center;
            position: relative;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .language-toggle {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .toggle-btn {
            background: #4A90E2;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            min-width: 260px;
            justify-content: center;
        }
        
        .toggle-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
        }
        
        .toggle-btn.active {
            background: #FF6B6B;
            transform: scale(1.05);
        }
        
        .toggle-btn i {
            margin-right: 8px;
            font-size: 1.2rem;
        }
        
        .main-content {
            display: flex;
            padding: 30px;
            gap: 30px;
        }
        
        .translation-box {
            flex: 1;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            padding: 25px;
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        
        .translation-box:hover {
            transform: translateY(-5px);
        }
        
        .translation-box h2 {
            color: #1e3c72;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #4A90E2;
            display: flex;
            align-items: center;
        }
        
        .translation-box h2 i {
            margin-right: 10px;
            color: #FF6B6B;
        }
        
        .input-area {
            margin-bottom: 25px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .input-area textarea {
            width: 100%;
            height: 120px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1.1rem;
            resize: none;
            transition: border-color 0.3s;
            flex: 1;
        }
        
        .input-area textarea:focus {
            outline: none;
            border-color: #4A90E2;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
        }
        
        .output-area {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            min-height: 150px;
            border: 1px solid #e0e0e0;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .output-text {
            font-size: 1.2rem;
            line-height: 1.6;
            color: #333;
            flex: 1;
        }
        
        .voice-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        .voice-btn {
            padding: 14px 28px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .start-btn {
            background: linear-gradient(90deg, #00C853, #009624);
            color: white;
        }
        
        .stop-btn {
            background: linear-gradient(90deg, #FF5252, #D32F2F);
            color: white;
        }
        
        .voice-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }
        
        .voice-btn i {
            margin-right: 10px;
            font-size: 1.3rem;
        }
        
        .status {
            text-align: center;
            margin-top: 20px;
            font-size: 1.1rem;
            font-weight: bold;
            min-height: 30px;
            padding: 10px;
            border-radius: 8px;
        }
        
        .status.ready {
            color: #1e3c72;
            background-color: #e3f2fd;
        }
        
        .status.listening {
            color: #00C853;
            background-color: #e8f5e9;
            animation: pulse 1.5s infinite;
        }
        
        .status.error {
            color: #D32F2F;
            background-color: #ffebee;
        }
        
        .instructions {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 20px;
            margin: 30px;
            text-align: center;
        }
        
        .instructions h3 {
            color: #1e3c72;
            margin-bottom: 15px;
        }
        
        .instructions p {
            margin-bottom: 10px;
            line-height: 1.6;
        }
        
        .flag {
            display: inline-block;
            width: 36px;
            height: 24px;
            margin: 0 8px;
            border-radius: 3px;
            vertical-align: middle;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            background-size: cover;
            background-position: center;
        }
        
        .flag-us {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="60" height="30"><path fill="%23b22234" d="M0 0h60v30H0z"/><path fill="%23fff" d="M0 0h60v18H0z"/><path fill="%233c3b6e" d="M0 0h24v18H0z"/><g fill="%23fff"><path d="M3 3h2v2H3zM7 3h2v2H7zM11 3h2v2h-2zM15 3h2v2h-2zM19 3h2v2h-2zM3 7h2v2H3zM7 7h2v2H7zM11 7h2v2h-2zM15 7h2v2h-2zM19 7h2v2h-2zM3 11h2v2H3zM7 11h2v2H7zM11 11h2v2h-2zM15 11h2v2h-2zM19 11h2v2h-2zM3 15h2v2H3zM7 15h2v2H7zM11 15h2v2h-2zM15 15h2v2h-2zM19 15h2v2h-2z"/></g></svg>');
        }
        
        .flag-vn {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 40" width="60" height="40"><path fill="%23da251d" d="M0 0h60v40H0z"/><path fill="%23ff0" d="M30 15l4.9 15-12.7-9.2H37.8L25.1 30z"/></svg>');
        }
        
        @media (max-width: 900px) {
            .main-content {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .toggle-btn {
                min-width: 220px;
                padding: 10px 15px;
                font-size: 1rem;
            }
        }
        
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(30, 60, 114, 0.3);
            border-radius: 50%;
            border-top-color: #1e3c72;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .translation-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .language-label {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            font-weight: bold;
            color: #1e3c72;
        }
        
        .copy-btn {
            background: #4A90E2;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 0.9rem;
            cursor: pointer;
            margin-left: auto;
            transition: all 0.2s;
        }
        
        .copy-btn:hover {
            background: #3a7bc8;
        }
        
        .translation-result {
            background: white;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            flex: 1;
            overflow-y: auto;
        }
        
        .mic-icon {
            margin-left: 10px;
            color: #FF6B6B;
            font-size: 1.2rem;
            animation: pulse 2s infinite;
        }
        
        .mic-active {
            color: #00C853;
            animation: none;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-language"></i> Dịch Song Song Anh-Việt</h1>
            <p class="subtitle">Ứng dụng dịch thuật song ngữ thời gian thực - Bắt đầu nói để dịch</p>
            
            <div class="language-toggle">
                <button id="en-vi-btn" class="toggle-btn active">
                    <i class="fas fa-arrow-right"></i> 
                    <span class="flag flag-us"></span> → <span class="flag flag-vn"></span>
                    Anh sang Việt
                </button>
                <button id="vi-en-btn" class="toggle-btn">
                    <i class="fas fa-arrow-right"></i> 
                    <span class="flag flag-vn"></span> → <span class="flag flag-us"></span>
                    Việt sang Anh
                </button>
            </div>
        </header>
        
        <div class="main-content">
            <div class="translation-box">
                <h2><i class="fas fa-microphone"></i> Chế độ Anh → Việt</h2>
                <div class="translation-container">
                    <div class="input-area">
                        <div class="language-label">
                            <span class="flag flag-us"></span> Tiếng Anh
                            <span id="en-mic" class="mic-icon"><i class="fas fa-microphone"></i></span>
                        </div>
                        <textarea id="en-input" placeholder="Nói tiếng Anh hoặc nhập văn bản..."></textarea>
                    </div>
                    <div class="output-area">
                        <div class="language-label">
                            <span class="flag flag-vn"></span> Tiếng Việt
                            <button class="copy-btn" data-target="vi-output">
                                <i class="fas fa-copy"></i> Sao chép
                            </button>
                        </div>
                        <div class="translation-result">
                            <div class="output-text" id="vi-output">Bản dịch tiếng Việt sẽ xuất hiện ở đây...</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="translation-box">
                <h2><i class="fas fa-microphone"></i> Chế độ Việt → Anh</h2>
                <div class="translation-container">
                    <div class="input-area">
                        <div class="language-label">
                            <span class="flag flag-vn"></span> Tiếng Việt
                            <span id="vi-mic" class="mic-icon"><i class="fas fa-microphone"></i></span>
                        </div>
                        <textarea id="vi-input" placeholder="Nói tiếng Việt hoặc nhập văn bản..."></textarea>
                    </div>
                    <div class="output-area">
                        <div class="language-label">
                            <span class="flag flag-us"></span> Tiếng Anh
                            <button class="copy-btn" data-target="en-output">
                                <i class="fas fa-copy"></i> Sao chép
                            </button>
                        </div>
                        <div class="translation-result">
                            <div class="output-text" id="en-output">English translation will appear here...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="voice-controls">
            <button id="start-btn" class="voice-btn start-btn">
                <i class="fas fa-microphone"></i> Bắt Đầu Nhận Diện Giọng Nói
            </button>
            <button id="stop-btn" class="voice-btn stop-btn" disabled>
                <i class="fas fa-microphone-slash"></i> Dừng Nhận Diện
            </button>
        </div>
        
        <div class="status ready" id="status">
            <i class="fas fa-check-circle"></i> Hệ thống sẵn sàng. Nhấn "Bắt Đầu Nhận Diện Giọng Nói" để bắt đầu!
        </div>
        
        <div class="instructions">
            <h3><i class="fas fa-info-circle"></i> Hướng dẫn sử dụng</h3>
            <p>1. Chọn chế độ dịch bằng nút chuyển đổi phía trên</p>
            <p>2. Nhấn "Bắt Đầu Nhận Diện Giọng Nói" để kích hoạt micro</p>
            <p>3. Nói bằng tiếng Anh hoặc tiếng Việt tùy theo chế độ đã chọn</p>
            <p>4. Kết quả dịch sẽ xuất hiện trong khung tương ứng</p>
            <p>5. Bạn cũng có thể nhập văn bản trực tiếp vào ô nhập liệu</p>
            <p>6. Sử dụng nút "Sao chép" để sao chép bản dịch</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Các phần tử DOM
            const enInput = document.getElementById('en-input');
            const viInput = document.getElementById('vi-input');
            const viOutput = document.getElementById('vi-output');
            const enOutput = document.getElementById('en-output');
            const startBtn = document.getElementById('start-btn');
            const stopBtn = document.getElementById('stop-btn');
            const statusEl = document.getElementById('status');
            const enViBtn = document.getElementById('en-vi-btn');
            const viEnBtn = document.getElementById('vi-en-btn');
            const copyButtons = document.querySelectorAll('.copy-btn');
            const enMic = document.getElementById('en-mic');
            const viMic = document.getElementById('vi-mic');
            
            // Biến trạng thái
            let isListening = false;
            let recognition = null;
            let currentMode = 'en-vi'; // 'en-vi' hoặc 'vi-en'
            let speechTimeout = null;
            
            // Khởi tạo nhận diện giọng nói
            function initSpeechRecognition() {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                
                if (!SpeechRecognition) {
                    statusEl.innerHTML = "<i class='fas fa-exclamation-triangle'></i> Trình duyệt của bạn không hỗ trợ nhận diện giọng nói. Vui lòng sử dụng Chrome hoặc Edge.";
                    statusEl.className = "status error";
                    startBtn.disabled = true;
                    return;
                }
                
                recognition = new SpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = currentMode === 'en-vi' ? 'en-US' : 'vi-VN';
                
                recognition.onresult = function(event) {
                    // Reset timeout khi có kết quả
                    clearTimeout(speechTimeout);
                    
                    let transcript = '';
                    let finalTranscript = '';
                    
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript;
                        } else {
                            // Hiển thị kết quả tạm thời
                            if (currentMode === 'en-vi') {
                                enInput.value = transcript;
                            } else {
                                viInput.value = transcript;
                            }
                        }
                    }
                    
                    if (finalTranscript) {
                        if (currentMode === 'en-vi') {
                            enInput.value = finalTranscript;
                            translateText(finalTranscript, 'en', 'vi', viOutput);
                        } else {
                            viInput.value = finalTranscript;
                            translateText(finalTranscript, 'vi', 'en', enOutput);
                        }
                        
                        // Hiệu ứng mic đang hoạt động
                        if (currentMode === 'en-vi') {
                            enMic.classList.add('mic-active');
                            setTimeout(() => {
                                enMic.classList.remove('mic-active');
                            }, 1000);
                        } else {
                            viMic.classList.add('mic-active');
                            setTimeout(() => {
                                viMic.classList.remove('mic-active');
                            }, 1000);
                        }
                    }
                };
                
                recognition.onerror = function(event) {
                    console.error('Speech recognition error', event.error);
                    
                    if (event.error === 'no-speech') {
                        statusEl.innerHTML = "<i class='fas fa-microphone-slash'></i> Không phát hiện giọng nói. Hãy nói rõ hơn hoặc đưa mic gần hơn.";
                        statusEl.className = "status error";
                        
                        // Tự động dừng sau 3 giây nếu không có giọng nói
                        speechTimeout = setTimeout(() => {
                            stopBtn.click();
                            statusEl.innerHTML = "<i class='fas fa-info-circle'></i> Đã dừng do không phát hiện giọng nói. Nhấn nút bắt đầu để thử lại.";
                            statusEl.className = "status ready";
                        }, 3000);
                    } else {
                        statusEl.innerHTML = `<i class='fas fa-exclamation-triangle'></i> Lỗi: ${event.error}`;
                        statusEl.className = "status error";
                    }
                };
                
                recognition.onend = function() {
                    if (isListening) {
                        recognition.start();
                    }
                };
            }
            
            // Hàm dịch văn bản sử dụng Google Translate API
            function translateText(text, sourceLang, targetLang, outputElement) {
                outputElement.innerHTML = `<div class="loading"></div> Đang dịch...`;
                
                // Sử dụng Google Translate API
                const apiUrl = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=${sourceLang}&tl=${targetLang}&dt=t&q=${encodeURIComponent(text)}`;
                
                fetch(apiUrl)
                    .then(response => response.json())
                    .then(data => {
                        // Kết hợp tất cả các phần dịch
                        if (data && data[0]) {
                            let translatedText = '';
                            for (let i = 0; i < data[0].length; i++) {
                                if (data[0][i] && data[0][i][0]) {
                                    translatedText += data[0][i][0];
                                }
                            }
                            outputElement.textContent = translatedText;
                        } else {
                            outputElement.textContent = "Không thể dịch văn bản này";
                        }
                    })
                    .catch(error => {
                        console.error('Translation error:', error);
                        outputElement.innerHTML = `<i class="fas fa-exclamation-triangle"></i> Lỗi dịch thuật: ${error.message}`;
                    });
            }
            
            // Xử lý sự kiện nút bắt đầu
            startBtn.addEventListener('click', function() {
                if (!recognition) initSpeechRecognition();
                
                try {
                    recognition.start();
                    isListening = true;
                    startBtn.disabled = true;
                    stopBtn.disabled = false;
                    statusEl.innerHTML = "<i class='fas fa-microphone'></i> Đang nghe... Hãy bắt đầu nói!";
                    statusEl.className = "status listening";
                    
                    // Thiết lập ngôn ngữ dựa trên chế độ hiện tại
                    recognition.lang = currentMode === 'en-vi' ? 'en-US' : 'vi-VN';
                    
                    // Hiệu ứng mic đang hoạt động
                    if (currentMode === 'en-vi') {
                        enMic.classList.add('mic-active');
                    } else {
                        viMic.classList.add('mic-active');
                    }
                } catch (error) {
                    statusEl.innerHTML = `<i class='fas fa-exclamation-triangle'></i> Lỗi khi khởi động nhận diện giọng nói: ${error.message}`;
                    statusEl.className = "status error";
                }
            });
            
            // Xử lý sự kiện nút dừng
            stopBtn.addEventListener('click', function() {
                if (recognition) {
                    recognition.stop();
                    isListening = false;
                    startBtn.disabled = false;
                    stopBtn.disabled = true;
                    statusEl.innerHTML = "<i class='fas fa-check-circle'></i> Đã dừng nhận diện giọng nói";
                    statusEl.className = "status ready";
                    
                    // Tắt hiệu ứng mic
                    enMic.classList.remove('mic-active');
                    viMic.classList.remove('mic-active');
                }
            });
            
            // Xử lý chuyển đổi chế độ
            enViBtn.addEventListener('click', function() {
                currentMode = 'en-vi';
                enViBtn.classList.add('active');
                viEnBtn.classList.remove('active');
                statusEl.innerHTML = "<i class='fas fa-info-circle'></i> Chế độ: Dịch Anh → Việt";
                statusEl.className = "status ready";
                
                if (recognition && isListening) {
                    recognition.stop();
                    recognition.lang = 'en-US';
                    recognition.start();
                    
                    // Hiệu ứng mic đang hoạt động
                    enMic.classList.add('mic-active');
                    viMic.classList.remove('mic-active');
                }
            });
            
            viEnBtn.addEventListener('click', function() {
                currentMode = 'vi-en';
                viEnBtn.classList.add('active');
                enViBtn.classList.remove('active');
                statusEl.innerHTML = "<i class='fas fa-info-circle'></i> Chế độ: Dịch Việt → Anh";
                statusEl.className = "status ready";
                
                if (recognition && isListening) {
                    recognition.stop();
                    recognition.lang = 'vi-VN';
                    recognition.start();
                    
                    // Hiệu ứng mic đang hoạt động
                    viMic.classList.add('mic-active');
                    enMic.classList.remove('mic-active');
                }
            });
            
            // Dịch khi người dùng nhập văn bản
            enInput.addEventListener('input', function() {
                if (enInput.value.trim()) {
                    translateText(enInput.value, 'en', 'vi', viOutput);
                } else {
                    viOutput.textContent = "Bản dịch tiếng Việt sẽ xuất hiện ở đây...";
                }
            });
            
            viInput.addEventListener('input', function() {
                if (viInput.value.trim()) {
                    translateText(viInput.value, 'vi', 'en', enOutput);
                } else {
                    enOutput.textContent = "English translation will appear here...";
                }
            });
            
            // Xử lý sao chép bản dịch
            copyButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-target');
                    const outputElement = document.getElementById(targetId);
                    const text = outputElement.textContent;
                    
                    navigator.clipboard.writeText(text)
                        .then(() => {
                            const originalText = this.innerHTML;
                            this.innerHTML = "<i class='fas fa-check'></i> Đã sao chép!";
                            
                            setTimeout(() => {
                                this.innerHTML = originalText;
                            }, 2000);
                        })
                        .catch(err => {
                            console.error('Copy failed: ', err);
                        });
                });
            });
            
            // Hiển thị thông báo khi trình duyệt không hỗ trợ API dịch
            if (!window.fetch) {
                statusEl.innerHTML = "<i class='fas fa-exclamation-triangle'></i> Trình duyệt của bạn không hỗ trợ tính năng dịch thuật. Vui lòng cập nhật trình duyệt.";
                statusEl.className = "status error";
            }
            
            // Demo các câu dịch dài
            setTimeout(() => {
                const longEnglishText = "What are you worried about? Did the baby have a bad reaction last time? I understand your concerns and want to ensure everything goes smoothly this time.";
                const longVietnameseText = "Chà đúng vậy, có ấy bị sốt một chút và khóc suốt một ngày và tôi cũng có thể đúng để thấy có ấy bị tổn thương. Có ấy rất nhỏ và đáng tin.";
                
                enInput.value = longEnglishText;
                viInput.value = longVietnameseText;
                
                translateText(longEnglishText, 'en', 'vi', viOutput);
                translateText(longVietnameseText, 'vi', 'en', enOutput);
            }, 1000);
        });
    </script>
</body>
</html>